From a4b70427b04145bf54728519a54ce452e9372f22 Mon Sep 17 00:00:00 2001
From: yousour <hengyousour@gmail.com>
Date: Tue, 17 Nov 2015 12:38:22 +0700
Subject: [PATCH] fix bug on register

---
 0001-close-menu-follow-the-role.patch        | 76 ++++++++++++++++++++++++++++
 dental/client/templates/register/register.js |  7 ++-
 2 files changed, 81 insertions(+), 2 deletions(-)
 create mode 100644 0001-close-menu-follow-the-role.patch

diff --git a/0001-close-menu-follow-the-role.patch b/0001-close-menu-follow-the-role.patch
new file mode 100644
index 0000000..a8c42eb
--- /dev/null
+++ b/0001-close-menu-follow-the-role.patch
@@ -0,0 +1,76 @@
+From 71a995356b6fe792c108a55be09bb8a307327903 Mon Sep 17 00:00:00 2001
+From: yousour <hengyousour@gmail.com>
+Date: Tue, 17 Nov 2015 10:38:47 +0700
+Subject: [PATCH] close menu follow the role
+
+---
+ dental/client/templates/layout/navbar.html | 14 +++++++++++---
+ dental/common/collections/patient.js       |  3 +--
+ 2 files changed, 12 insertions(+), 5 deletions(-)
+
+diff --git a/dental/client/templates/layout/navbar.html b/dental/client/templates/layout/navbar.html
+index ec9e085..229c593 100644
+--- a/dental/client/templates/layout/navbar.html
++++ b/dental/client/templates/layout/navbar.html
+@@ -1,6 +1,7 @@
+ <template name="dental_navbar">
+         <li class="{{isActiveRoute name='dental.home'}}"><a href="{{pathFor 'dental.home'}}">Home</a></li>
+-
++ {{#if isInRole 'data-insert,data-update,data-remove,data-patient-insert' 'Dental'}}
++ <!--Data-->
+         <li class="dropdown">
+             <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
+                 Data <span class="caret"></span>
+@@ -35,12 +36,16 @@
+             </ul>
+         </li>
+ 
++
+         <!--Calendar-->
+         <li class="{{isActiveRoute name='dental.calendar'}}"><a href="{{pathFor 'dental.calendar'}}">Calendar</a></li>
+ 
+-        <!-- Alert Event Message -->
++        <!--Alert Event Message-->
+         {{> dental_alertEventMsg}}
++{{/if}}
+ 
++        <!--Report-->
++ {{#if isInRole 'reporter' 'Dental'}}
+         <li class="dropdown">
+             <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
+                 Reports <span class="caret"></span>
+@@ -110,7 +115,10 @@
+ 
+             </ul>
+         </li>
++{{/if}}
+ 
++<!--Setting-->
++ {{#if isInRole 'setting' 'Dental'}}
+         <li class="dropdown">
+             <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
+                 Setting <span class="caret"></span>
+@@ -164,5 +172,5 @@
+ 
+             </ul>
+         </li>
+-
++{{/if}}
+ </template>
+diff --git a/dental/common/collections/patient.js b/dental/common/collections/patient.js
+index bfc9b08..fc70731 100644
+--- a/dental/common/collections/patient.js
++++ b/dental/common/collections/patient.js
+@@ -27,8 +27,7 @@ Dental.Schema.Patient = new SimpleSchema({
+   age: {
+     type: Number,
+     max: 110,
+-    min: 1,
+-    optional: true
++    min: 1
+   },
+   occupation: {
+     type: String,
+-- 
+1.9.1
+
diff --git a/dental/client/templates/register/register.js b/dental/client/templates/register/register.js
index a1748b7..704b4f7 100644
--- a/dental/client/templates/register/register.js
+++ b/dental/client/templates/register/register.js
@@ -262,7 +262,8 @@ Template.dental_registerInsert.events({
     var index = 0;
     $('div.array-item').each(function() {
       //clear selectize
-      $('select.item')[index].selectize.clear(true);
+      var cssSelector = '[name="disease.' + index + '.item"]';
+      $(cssSelector)[0].selectize.clear(true);
       index++;
     });
 
@@ -488,7 +489,9 @@ Template.afArrayField_customArrayFieldInvoiceForLaboExpense.events({
     });
 
     //get price labo item
-    thisObj.parents('div.array-item').find('.laboAmount').val(laboDoc.price);
+    if (!_.isUndefined(laboDoc)) {
+      thisObj.parents('div.array-item').find('.laboAmount').val(laboDoc.price);
+    }
     // Cal footer for labo expense
     calculateTotalForLaboExpense();
 
-- 
1.9.1

