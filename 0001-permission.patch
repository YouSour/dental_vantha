From ca297797cb0a8d7362bce4f089d4cdebadd3920f Mon Sep 17 00:00:00 2001
From: yousour <hengyousour@gmail.com>
Date: Tue, 17 Nov 2015 08:50:14 +0700
Subject: [PATCH] permission

---
 dental/common/lib/config/module.js      |   7 +-
 dental/server/app/security.js           |  97 +++++---
 dental/server/security/calendarEvent.js |  16 +-
 dental/server/security/security.js      | 397 +++++++++++++++++++-------------
 4 files changed, 322 insertions(+), 195 deletions(-)

diff --git a/dental/common/lib/config/module.js b/dental/common/lib/config/module.js
index 539f3a8..9fe2408 100644
--- a/dental/common/lib/config/module.js
+++ b/dental/common/lib/config/module.js
@@ -9,8 +9,11 @@ Module.Dental = {
   version: '0.0.1',
   summary: 'Dental Clinic System is ...',
   roles: [
-    'admin',
-    'general',
+    'setting',
+    'data-insert',
+    'data-update',
+    'data-remove',
+    'data-patient-insert',
     'reporter'
   ],
   dump: {
diff --git a/dental/server/app/security.js b/dental/server/app/security.js
index e25fc45..0290ed5 100644
--- a/dental/server/app/security.js
+++ b/dental/server/app/security.js
@@ -1,32 +1,65 @@
-/**
- * Admin
- */
-Security.defineMethod("dental_ifAdmin", {
-    fetch: [],
-    transform: null,
-    deny: function (type, arg, userId) {
-        return !Roles.userIsInRole(userId, ['admin'], 'Dental');
-    }
-});
-
-/**
- * General
- */
-Security.defineMethod("dental_ifGeneral", {
-    fetch: [],
-    transform: null,
-    deny: function (type, arg, userId) {
-        return !Roles.userIsInRole(userId, ['general'], 'Dental');
-    }
-});
-
-/**
- * Reporter
- */
-Security.defineMethod("dental_ifReporter", {
-    fetch: [],
-    transform: null,
-    deny: function (type, arg, userId) {
-        return !Roles.userIsInRole(userId, ['reporter'], 'Dental');
-    }
-});
+/**
+ * Setting
+ */
+Security.defineMethod("dental_ifSetting", {
+  fetch: [],
+  transform: null,
+  deny: function(type, arg, userId) {
+    return !Roles.userIsInRole(userId, ['setting'], 'Dental');
+  }
+});
+
+/**
+ * Data Insert
+ */
+Security.defineMethod("dental_ifDataInsert", {
+  fetch: [],
+  transform: null,
+  deny: function(type, arg, userId) {
+    return !Roles.userIsInRole(userId, ['data-insert'], 'Dental');
+  }
+});
+
+/**
+ * Data Update
+ */
+Security.defineMethod("dental_ifDataUpdate", {
+  fetch: [],
+  transform: null,
+  deny: function(type, arg, userId) {
+    return !Roles.userIsInRole(userId, ['data-update'], 'Dental');
+  }
+});
+
+/**
+ * Data Remove
+ */
+Security.defineMethod("dental_ifDataRemove", {
+  fetch: [],
+  transform: null,
+  deny: function(type, arg, userId) {
+    return !Roles.userIsInRole(userId, ['data-remove'], 'Dental');
+  }
+});
+
+/**
+ * Data Patient Insert
+ */
+Security.defineMethod("dental_ifDataPatientInsert", {
+  fetch: [],
+  transform: null,
+  deny: function(type, arg, userId) {
+    return !Roles.userIsInRole(userId, ['data-patient-insert'], 'Dental');
+  }
+});
+
+/**
+ * Reporter
+ */
+Security.defineMethod("dental_ifReporter", {
+  fetch: [],
+  transform: null,
+  deny: function(type, arg, userId) {
+    return !Roles.userIsInRole(userId, ['reporter'], 'Dental');
+  }
+});
diff --git a/dental/server/security/calendarEvent.js b/dental/server/security/calendarEvent.js
index 3899a86..fea5818 100644
--- a/dental/server/security/calendarEvent.js
+++ b/dental/server/security/calendarEvent.js
@@ -1,4 +1,12 @@
-// Security
-Dental.Collection.CalendarEvent.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
\ No newline at end of file
+// Security
+Dental.Collection.CalendarEvent.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.CalendarEvent.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.CalendarEvent.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
diff --git a/dental/server/security/security.js b/dental/server/security/security.js
index 97c8907..55983d7 100644
--- a/dental/server/security/security.js
+++ b/dental/server/security/security.js
@@ -1,157 +1,240 @@
-/**
- * Staff
- */
-Dental.Collection.Staff.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/**
- * Doctor
- */
-Dental.Collection.Doctor.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/**
- * Disease Category
- */
-
-Dental.Collection.DiseaseCategory.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Disease Item
- */
-
-Dental.Collection.DiseaseItem.permit(['insert', 'update', 'remove'])
-    .dental_ifAdmin()
-    .apply();
-
-/*
- * Patient History
- */
-
-Dental.Collection.PatientHistory.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Patient
- */
-
-Dental.Collection.Patient.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Laboratory
- */
-Dental.Collection.Laboratory.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Material Cost
- */
-Dental.Collection.MaterialCost.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Material Cost Category
- */
-Dental.Collection.MaterialCostCategory.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Material Cost Item
- */
-Dental.Collection.MaterialCostItem.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- *Supplier
- */
-Dental.Collection.Supplier.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Order Category
- */
-Dental.Collection.OrderCategory.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- *Order Item
- */
-Dental.Collection.OrderItem.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- *Register
- */
-Dental.Collection.Register.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- *Special Register
- */
-Dental.Collection.SpecialRegister.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- *Treatment
- */
-Dental.Collection.Treatment.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- *Deposit
- */
-Dental.Collection.Deposit.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Invoice
- */
-Dental.Collection.Invoice.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- *Purchase
- */
-Dental.Collection.Purchase.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Payment
- */
-Dental.Collection.Payment.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-/*
- *Special Payment
- */
-Dental.Collection.SpecialPayment.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
-/*
- * Quotation
- */
-Dental.Collection.Quotation.permit(['insert', 'update', 'remove'])
-    .dental_ifGeneral()
-    .apply();
-
+/**
+ * Staff
+ */
+Dental.Collection.Staff.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/**
+ * Doctor
+ */
+Dental.Collection.Doctor.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/**
+ * Disease Category
+ */
+Dental.Collection.DiseaseCategory.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ * Disease Item
+ */
+
+Dental.Collection.DiseaseItem.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ * Patient History
+ */
+
+Dental.Collection.PatientHistory.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ * Patient
+ */
+
+Dental.Collection.Patient.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.Patient.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.Patient.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
+
+Dental.Collection.Patient.permit(['insert', 'update'])
+  .dental_ifDataPatientInsert()
+  .apply();
+
+/*
+ * Laboratory
+ */
+Dental.Collection.Laboratory.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ * Material Cost
+ */
+Dental.Collection.MaterialCost.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ * Material Cost Category
+ */
+Dental.Collection.MaterialCostCategory.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ * Material Cost Item
+ */
+Dental.Collection.MaterialCostItem.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ *Supplier
+ */
+Dental.Collection.Supplier.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ * Order Category
+ */
+Dental.Collection.OrderCategory.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ *Order Item
+ */
+Dental.Collection.OrderItem.permit(['insert', 'update', 'remove'])
+  .dental_ifSetting()
+  .apply();
+
+/*
+ *Register
+ */
+Dental.Collection.Register.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.Register.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.Register.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
+
+/*
+ *Special Register
+ */
+Dental.Collection.SpecialRegister.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.SpecialRegister.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.SpecialRegister.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
+
+/*
+ *Treatment
+ */
+Dental.Collection.Treatment.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.Treatment.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.Treatment.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
+
+/*
+ *Deposit
+ */
+Dental.Collection.Deposit.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.Deposit.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.Deposit.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
+
+/*
+ * Invoice
+ */
+Dental.Collection.Invoice.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.Invoice.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.Invoice.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
+
+/*
+ *Purchase
+ */
+Dental.Collection.Purchase.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.Purchase.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.Purchase.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
+
+/*
+ * Payment
+ */
+Dental.Collection.Payment.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.Payment.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.Payment.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
+
+/*
+ *Special Payment
+ */
+Dental.Collection.SpecialPayment.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.SpecialPayment.permit(['update'])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.SpecialPayment.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
+
+/*
+ * Quotation
+ */
+Dental.Collection.Quotation.permit(['insert'])
+  .dental_ifDataInsert()
+  .apply();
+
+Dental.Collection.Quotation.permit(['update', ])
+  .dental_ifDataUpdate()
+  .apply();
+
+Dental.Collection.Quotation.permit(['remove'])
+  .dental_ifDataRemove()
+  .apply();
-- 
1.9.1

