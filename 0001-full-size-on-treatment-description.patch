From fc27698ee68bd4c37c38b8955ac643ddbf6772a8 Mon Sep 17 00:00:00 2001
From: yousour <hengyousour@gmail.com>
Date: Wed, 18 Nov 2015 15:05:34 +0700
Subject: [PATCH] full size on treatment description

---
 0001-add-full-size-on-summernote.patch             | 275 +++++++++++++++++++++
 dental/client/templates/register/register.js       |   9 +-
 .../templates/reports/treatmentDescription.html    |  17 ++
 .../templates/reports/treatmentDescription.js      |  17 ++
 dental/client/templates/treatment/treatment.html   |  29 +--
 dental/client/templates/treatment/treatment.js     |  10 +-
 .../client/templates/treatment/treatmentInfo.html  |   2 +-
 dental/common/collections/treatment.js             |   2 +-
 dental/common/routers/treatmentDescription.js      |  22 ++
 .../server/methods/reports/treatmentDescription.js |  41 +++
 10 files changed, 395 insertions(+), 29 deletions(-)
 create mode 100644 0001-add-full-size-on-summernote.patch
 create mode 100644 dental/client/templates/reports/treatmentDescription.html
 create mode 100644 dental/client/templates/reports/treatmentDescription.js
 create mode 100644 dental/common/routers/treatmentDescription.js
 create mode 100644 dental/server/methods/reports/treatmentDescription.js

diff --git a/0001-add-full-size-on-summernote.patch b/0001-add-full-size-on-summernote.patch
new file mode 100644
index 0000000..26fe808
--- /dev/null
+++ b/0001-add-full-size-on-summernote.patch
@@ -0,0 +1,275 @@
+From dc39a870d5bda85aa885e4b4679621a8f5398759 Mon Sep 17 00:00:00 2001
+From: yousour <hengyousour@gmail.com>
+Date: Wed, 18 Nov 2015 09:29:32 +0700
+Subject: [PATCH] add full size on summernote
+
+---
+ 0001-fix-bug-on-register.patch                    | 121 ++++++++++++++++++++++
+ dental/common/collections/doctor.js               |   3 +-
+ dental/common/collections/materialCostCategory.js |   3 +-
+ dental/common/collections/orderCategory.js        |   3 +-
+ dental/common/collections/patient.js              |   3 +-
+ dental/common/collections/patientHistory.js       |   3 +-
+ dental/common/collections/payment.js              |   3 +-
+ dental/common/collections/specialPayment.js       |   3 +-
+ dental/common/collections/supplier.js             |   3 +-
+ dental/common/collections/treatment.js            |   3 +-
+ 10 files changed, 139 insertions(+), 9 deletions(-)
+ create mode 100644 0001-fix-bug-on-register.patch
+
+diff --git a/0001-fix-bug-on-register.patch b/0001-fix-bug-on-register.patch
+new file mode 100644
+index 0000000..9b55044
+--- /dev/null
++++ b/0001-fix-bug-on-register.patch
+@@ -0,0 +1,121 @@
++From a4b70427b04145bf54728519a54ce452e9372f22 Mon Sep 17 00:00:00 2001
++From: yousour <hengyousour@gmail.com>
++Date: Tue, 17 Nov 2015 12:38:22 +0700
++Subject: [PATCH] fix bug on register
++
++---
++ 0001-close-menu-follow-the-role.patch        | 76 ++++++++++++++++++++++++++++
++ dental/client/templates/register/register.js |  7 ++-
++ 2 files changed, 81 insertions(+), 2 deletions(-)
++ create mode 100644 0001-close-menu-follow-the-role.patch
++
++diff --git a/0001-close-menu-follow-the-role.patch b/0001-close-menu-follow-the-role.patch
++new file mode 100644
++index 0000000..a8c42eb
++--- /dev/null
+++++ b/0001-close-menu-follow-the-role.patch
++@@ -0,0 +1,76 @@
+++From 71a995356b6fe792c108a55be09bb8a307327903 Mon Sep 17 00:00:00 2001
+++From: yousour <hengyousour@gmail.com>
+++Date: Tue, 17 Nov 2015 10:38:47 +0700
+++Subject: [PATCH] close menu follow the role
+++
+++---
+++ dental/client/templates/layout/navbar.html | 14 +++++++++++---
+++ dental/common/collections/patient.js       |  3 +--
+++ 2 files changed, 12 insertions(+), 5 deletions(-)
+++
+++diff --git a/dental/client/templates/layout/navbar.html b/dental/client/templates/layout/navbar.html
+++index ec9e085..229c593 100644
+++--- a/dental/client/templates/layout/navbar.html
++++++ b/dental/client/templates/layout/navbar.html
+++@@ -1,6 +1,7 @@
+++ <template name="dental_navbar">
+++         <li class="{{isActiveRoute name='dental.home'}}"><a href="{{pathFor 'dental.home'}}">Home</a></li>
+++-
++++ {{#if isInRole 'data-insert,data-update,data-remove,data-patient-insert' 'Dental'}}
++++ <!--Data-->
+++         <li class="dropdown">
+++             <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
+++                 Data <span class="caret"></span>
+++@@ -35,12 +36,16 @@
+++             </ul>
+++         </li>
+++ 
++++
+++         <!--Calendar-->
+++         <li class="{{isActiveRoute name='dental.calendar'}}"><a href="{{pathFor 'dental.calendar'}}">Calendar</a></li>
+++ 
+++-        <!-- Alert Event Message -->
++++        <!--Alert Event Message-->
+++         {{> dental_alertEventMsg}}
++++{{/if}}
+++ 
++++        <!--Report-->
++++ {{#if isInRole 'reporter' 'Dental'}}
+++         <li class="dropdown">
+++             <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
+++                 Reports <span class="caret"></span>
+++@@ -110,7 +115,10 @@
+++ 
+++             </ul>
+++         </li>
++++{{/if}}
+++ 
++++<!--Setting-->
++++ {{#if isInRole 'setting' 'Dental'}}
+++         <li class="dropdown">
+++             <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
+++                 Setting <span class="caret"></span>
+++@@ -164,5 +172,5 @@
+++ 
+++             </ul>
+++         </li>
+++-
++++{{/if}}
+++ </template>
+++diff --git a/dental/common/collections/patient.js b/dental/common/collections/patient.js
+++index bfc9b08..fc70731 100644
+++--- a/dental/common/collections/patient.js
++++++ b/dental/common/collections/patient.js
+++@@ -27,8 +27,7 @@ Dental.Schema.Patient = new SimpleSchema({
+++   age: {
+++     type: Number,
+++     max: 110,
+++-    min: 1,
+++-    optional: true
++++    min: 1
+++   },
+++   occupation: {
+++     type: String,
+++-- 
+++1.9.1
+++
++diff --git a/dental/client/templates/register/register.js b/dental/client/templates/register/register.js
++index a1748b7..704b4f7 100644
++--- a/dental/client/templates/register/register.js
+++++ b/dental/client/templates/register/register.js
++@@ -262,7 +262,8 @@ Template.dental_registerInsert.events({
++     var index = 0;
++     $('div.array-item').each(function() {
++       //clear selectize
++-      $('select.item')[index].selectize.clear(true);
+++      var cssSelector = '[name="disease.' + index + '.item"]';
+++      $(cssSelector)[0].selectize.clear(true);
++       index++;
++     });
++ 
++@@ -488,7 +489,9 @@ Template.afArrayField_customArrayFieldInvoiceForLaboExpense.events({
++     });
++ 
++     //get price labo item
++-    thisObj.parents('div.array-item').find('.laboAmount').val(laboDoc.price);
+++    if (!_.isUndefined(laboDoc)) {
+++      thisObj.parents('div.array-item').find('.laboAmount').val(laboDoc.price);
+++    }
++     // Cal footer for labo expense
++     calculateTotalForLaboExpense();
++ 
++-- 
++1.9.1
++
+diff --git a/dental/common/collections/doctor.js b/dental/common/collections/doctor.js
+index 438779a..c6a02ca 100644
+--- a/dental/common/collections/doctor.js
++++ b/dental/common/collections/doctor.js
+@@ -58,7 +58,8 @@ Dental.Schema.Doctor = new SimpleSchema({
+             ['font', ['strikethrough']],
+             ['fontsize', ['fontsize']],
+             ['color', ['color']],
+-            ['para', ['ul', 'ol', 'paragraph']]
++            ['para', ['ul', 'ol', 'paragraph']],
++            ['misc', ['fullscreen']]
+           ]
+         }
+       }
+diff --git a/dental/common/collections/materialCostCategory.js b/dental/common/collections/materialCostCategory.js
+index 44d3664..3723dac 100644
+--- a/dental/common/collections/materialCostCategory.js
++++ b/dental/common/collections/materialCostCategory.js
+@@ -33,7 +33,8 @@ Dental.Schema.MaterialCostCategory = new SimpleSchema({
+             ['font', ['strikethrough']],
+             ['fontsize', ['fontsize']],
+             ['color', ['color']],
+-            ['para', ['ul', 'ol', 'paragraph']]
++            ['para', ['ul', 'ol', 'paragraph']],
++            ['misc', ['fullscreen']]
+           ]
+         }
+       }
+diff --git a/dental/common/collections/orderCategory.js b/dental/common/collections/orderCategory.js
+index 1c4f9c3..7fbf821 100644
+--- a/dental/common/collections/orderCategory.js
++++ b/dental/common/collections/orderCategory.js
+@@ -32,7 +32,8 @@ Dental.Schema.OrderCategory = new SimpleSchema({
+             ['font', ['strikethrough']],
+             ['fontsize', ['fontsize']],
+             ['color', ['color']],
+-            ['para', ['ul', 'ol', 'paragraph']]
++            ['para', ['ul', 'ol', 'paragraph']],
++            ['misc', ['fullscreen']]
+           ]
+         }
+       }
+diff --git a/dental/common/collections/patient.js b/dental/common/collections/patient.js
+index fc70731..448549d 100644
+--- a/dental/common/collections/patient.js
++++ b/dental/common/collections/patient.js
+@@ -79,7 +79,8 @@ Dental.Schema.Patient = new SimpleSchema({
+             ['font', ['strikethrough']],
+             ['fontsize', ['fontsize']],
+             ['color', ['color']],
+-            ['para', ['ul', 'ol', 'paragraph']]
++            ['para', ['ul', 'ol', 'paragraph']],
++            ['misc', ['fullscreen']],
+           ]
+         }
+       }
+diff --git a/dental/common/collections/patientHistory.js b/dental/common/collections/patientHistory.js
+index fcbaf55..bc3daad 100644
+--- a/dental/common/collections/patientHistory.js
++++ b/dental/common/collections/patientHistory.js
+@@ -28,7 +28,8 @@ Dental.Schema.PatientHistory = new SimpleSchema({
+             ['font', ['strikethrough']],
+             ['fontsize', ['fontsize']],
+             ['color', ['color']],
+-            ['para', ['ul', 'ol', 'paragraph']]
++            ['para', ['ul', 'ol', 'paragraph']],
++            ['misc', ['fullscreen']]
+           ]
+         }
+       }
+diff --git a/dental/common/collections/payment.js b/dental/common/collections/payment.js
+index 3c0aeaa..cf2e12b 100644
+--- a/dental/common/collections/payment.js
++++ b/dental/common/collections/payment.js
+@@ -83,7 +83,8 @@ Dental.Schema.Payment = new SimpleSchema({
+             ['font', ['strikethrough']],
+             ['fontsize', ['fontsize']],
+             ['color', ['color']],
+-            ['para', ['ul', 'ol', 'paragraph']]
++            ['para', ['ul', 'ol', 'paragraph']],
++            ['misc', ['fullscreen']]
+           ]
+         }
+       }
+diff --git a/dental/common/collections/specialPayment.js b/dental/common/collections/specialPayment.js
+index fbd00fb..d4de894 100644
+--- a/dental/common/collections/specialPayment.js
++++ b/dental/common/collections/specialPayment.js
+@@ -88,7 +88,8 @@ Dental.Schema.SpecialPayment = new SimpleSchema({
+             ['font', ['strikethrough']],
+             ['fontsize', ['fontsize']],
+             ['color', ['color']],
+-            ['para', ['ul', 'ol', 'paragraph']]
++            ['para', ['ul', 'ol', 'paragraph']],
++            ['misc', ['fullscreen']],
+           ]
+         }
+       }
+diff --git a/dental/common/collections/supplier.js b/dental/common/collections/supplier.js
+index e5984fe..8d114bb 100644
+--- a/dental/common/collections/supplier.js
++++ b/dental/common/collections/supplier.js
+@@ -40,7 +40,8 @@ Dental.Schema.Supplier = new SimpleSchema({
+             ['font', ['strikethrough']],
+             ['fontsize', ['fontsize']],
+             ['color', ['color']],
+-            ['para', ['ul', 'ol', 'paragraph']]
++            ['para', ['ul', 'ol', 'paragraph']],
++            ['misc', ['fullscreen']]
+           ]
+         }
+       }
+diff --git a/dental/common/collections/treatment.js b/dental/common/collections/treatment.js
+index 7802c83..43c11d6 100644
+--- a/dental/common/collections/treatment.js
++++ b/dental/common/collections/treatment.js
+@@ -49,7 +49,8 @@ Dental.Schema.Treatment = new SimpleSchema({
+             ['fontsize', ['fontsize']],
+             ['color', ['color']],
+             ['para', ['ul', 'ol', 'paragraph']],
+-            ['insert', ['picture']]
++            ['insert', ['picture']],
++            ['misc', ['fullscreen']],
+           ]
+         }
+       }
+-- 
+1.9.1
+
diff --git a/dental/client/templates/register/register.js b/dental/client/templates/register/register.js
index 704b4f7..ed8b331 100644
--- a/dental/client/templates/register/register.js
+++ b/dental/client/templates/register/register.js
@@ -137,7 +137,7 @@ Template.dental_register.events({
       alertify.treatmentAction(
         fa("plus", "Treatment"),
         renderTemplate(Template.dental_treatmentInsert, data)
-      );
+      ).maximize();
     }
     // }
   },
@@ -330,8 +330,13 @@ Template.dental_registerUpdate.events({
   'click .patientAddon': function(e, t) {
     alertify.patientAddon(fa("plus", "Patient"), renderTemplate(Template.dental_patientInsert))
       .maximize();
+  },
+  'click .showDescription': function() {
+    // Show Description
+    var q = 'treatmentId=' + this._id;
+    var url = 'treatmentDescriptionGen?' + q;
+    window.open(url);
   }
-
 });
 
 /**
diff --git a/dental/client/templates/reports/treatmentDescription.html b/dental/client/templates/reports/treatmentDescription.html
new file mode 100644
index 0000000..922a754
--- /dev/null
+++ b/dental/client/templates/reports/treatmentDescription.html
@@ -0,0 +1,17 @@
+<!--Show Description-->
+<template name="dental_treatmentDescription">
+  <div class="page-header">
+  <h1>Description</h1>
+  <hr>
+  {{#if data}}
+  {{#with data}}
+      {{#each content}}
+  <p>{{{des}}}</p>
+  {{/each}}
+  {{/with}}
+  {{else}}
+  {{> loading}}
+  {{/if}}
+
+</div>
+</template>
diff --git a/dental/client/templates/reports/treatmentDescription.js b/dental/client/templates/reports/treatmentDescription.js
new file mode 100644
index 0000000..95a1f6e
--- /dev/null
+++ b/dental/client/templates/reports/treatmentDescription.js
@@ -0,0 +1,17 @@
+Dental.ListForReportState = new ReactiveObj();
+
+/************ Generate **** *********/
+Template.dental_treatmentDescription.helpers({
+  data: function() {
+    var self = this;
+    var callId = JSON.stringify(self);
+    var call = Meteor.callAsync(callId, 'dental_treatmentDescription',
+      self);
+
+    if (!call.ready()) {
+      return false;
+    }
+
+    return call.result();
+  }
+});
diff --git a/dental/client/templates/treatment/treatment.html b/dental/client/templates/treatment/treatment.html
index caaab5e..e083dee 100644
--- a/dental/client/templates/treatment/treatment.html
+++ b/dental/client/templates/treatment/treatment.html
@@ -24,19 +24,17 @@
 
 <!--Action-->
 <template name="dental_treatmentDesAction">
-  <button type="button" class="btn btn-sm btn-primary btn-block showDescription">{{fa "eye"}} Show</button>
+<button type="button" class="btn btn-sm btn-primary btn-block showDescription">{{fa "eye"}} Show</button>
 </template>
 
 <!--Insert-->
 <template name="dental_treatmentInsert">
     {{#autoForm collection=Dental.Collection.Treatment id="dental_treatmentInsert" type="insert"}}
         <div class="row">
-            <div class="col-md-12">
-
-                {{> afQuickField name="patientId" type="hidden" value=patientId}}
-                {{> afQuickField name="registerId"  type="hidden" value=_id}}
+<div class="col-md-6">
                 {{> afQuickField name="treatmentDate"}}
-
+</div>
+<div class="col-md-6">
                 <div class="form-group{{#if afFieldIsInvalid name='doctorId'}} has-error{{/if}}" data-required="true">
                     <label class="control-label" for="doctorId">Doctor</label>
 
@@ -52,7 +50,11 @@
                         <span class="help-block">{{afFieldMessage name='doctorId'}}</span>
                     {{/if}}
                 </div>
+</div>
+<div class="col-md-12">
 
+    {{> afQuickField name="patientId" type="hidden" value=patientId}}
+    {{> afQuickField name="registerId"  type="hidden" value=_id}}
                 {{> afQuickField name="des" rows=3}}
                 <!-- {{> afQuickField name="attachFile"}} -->
 
@@ -124,18 +126,3 @@
         <dd>{{lightbox url=attachFileUrl title=_doctor.name icon="paperclip"}}</dd> -->
     </dl>
 </template>
-
-<!--Show Description-->
-<template name="dental_treatmentShowDescription">
-    <!-- <div class="bs-callout bs-callout-default" id="callout-tables-striped-ie8">
-    <h4>Description</h4>
-    <hr>
-    <p></p>
-  </div> -->
-
-  <div class="page-header">
-  <h1>Description</h1>
-  <hr>
-  <p>{{{des}}}</p>
-</div>
-</template>
diff --git a/dental/client/templates/treatment/treatment.js b/dental/client/templates/treatment/treatment.js
index 06c6abe..136b31b 100644
--- a/dental/client/templates/treatment/treatment.js
+++ b/dental/client/templates/treatment/treatment.js
@@ -23,14 +23,14 @@ Template.dental_treatment.events({
     Session.set('closeTreatment', true);
     var data = Dental.RegisterState.get('data');
     alertify.treatment(fa("plus", "Treatment"), renderTemplate(Template.dental_treatmentInsert,
-      data));
+      data)).maximize();
   },
   'click .update': function() {
     var data = Dental.Collection.Treatment.findOne({
       _id: this._id
     });
     alertify.treatment(fa("pencil", "Treatment"), renderTemplate(Template
-      .dental_treatmentUpdate, data));
+      .dental_treatmentUpdate, data)).maximize();
   },
   'click .remove': function() {
     var self = this;
@@ -61,8 +61,10 @@ Template.dental_treatment.events({
       data));
   },
   'click .showDescription': function() {
-    alertify.alert(fa("eye", "Treatment"), renderTemplate(Template.dental_treatmentShowDescription,
-      this));
+    // Show Description
+    var q = 'treatmentId=' + this._id;
+    var url = 'treatmentDescriptionGen?' + q;
+    window.open(url);
   }
 });
 
diff --git a/dental/client/templates/treatment/treatmentInfo.html b/dental/client/templates/treatment/treatmentInfo.html
index 5fe9f47..0597e26 100644
--- a/dental/client/templates/treatment/treatmentInfo.html
+++ b/dental/client/templates/treatment/treatmentInfo.html
@@ -6,7 +6,7 @@
             <ul class="list-unstyled">
                 {{#each data}}
                     <li><strong>Date:</strong> {{treatmentDate}}</li>
-                    <li><strong>Des:</strong> {{{des}}}</li>
+                    <li><strong>Des:</strong> <a href="#" class="showDescription">View</a></li>
                     <li style="border-bottom: 1px solid;">
                         <li><strong>Doctor:</strong> {{_doctor.name}}</li>
                         <!-- <strong>Attach File:</strong> {{lightbox url=attachFileUrl title=_doctor.name icon="paperclip"}} -->
diff --git a/dental/common/collections/treatment.js b/dental/common/collections/treatment.js
index 43c11d6..74204ed 100644
--- a/dental/common/collections/treatment.js
+++ b/dental/common/collections/treatment.js
@@ -41,7 +41,7 @@ Dental.Schema.Treatment = new SimpleSchema({
         type: 'summernote',
         class: 'editor',
         settings: {
-          height: 100,
+          height: 340,
           toolbar: [
             //[groupname, [button list]]
             ['style', ['bold', 'italic', 'underline']],
diff --git a/dental/common/routers/treatmentDescription.js b/dental/common/routers/treatmentDescription.js
new file mode 100644
index 0000000..7b30572
--- /dev/null
+++ b/dental/common/routers/treatmentDescription.js
@@ -0,0 +1,22 @@
+Router.route('dental/treatmentDescriptionGen', function() {
+  // Config layout
+  this.layout('reportLayout', {
+    // Page size: a4, a5, mini
+    // Orientation: portrait, landscape
+    // Font size: fontBody: undefined (10px), bg (12px)
+    data: {
+      pageSize: '',
+      orientation: 'portrait',
+      fontBody: 'bg'
+    }
+  });
+
+  var q = this.params.query;
+  this.render('dental_treatmentDescription', {
+    data: function() {
+      return q;
+    }
+  });
+}, {
+  name: 'dental.treatmentDescriptionGen'
+});
diff --git a/dental/server/methods/reports/treatmentDescription.js b/dental/server/methods/reports/treatmentDescription.js
new file mode 100644
index 0000000..91475a6
--- /dev/null
+++ b/dental/server/methods/reports/treatmentDescription.js
@@ -0,0 +1,41 @@
+Meteor.methods({
+  dental_treatmentDescription: function(params) {
+    var self = params;
+    var data = {
+      title: {},
+      header: {},
+      content: []
+    };
+
+    /********* Title *********/
+    // var company = Cpanel.Collection.Company.findOne();
+    // data.title = {
+    //   company: company
+    // };
+
+    /********* Header ********/
+    // var registerDoc = Dental.Collection.Register.findOne(self.register);
+    // data.header = registerDoc;
+
+    /********** Content & Footer **********/
+    var content = [];
+
+    // Get treament
+    Dental.Collection.Treatment.find({
+        _id: self.treatmentId
+      })
+      .forEach(function(obj) {
+        content.push(obj);
+      });
+
+    if (content.length > 0) {
+      data.content = content;
+      return data;
+    } else {
+      data.content.push({
+        index: 'no results'
+      });
+      return data;
+    }
+  }
+});
-- 
1.9.1

